var SQR={TWOPI:2*Math.PI,HALFPI:.5*Math.PI,EPSILON:1e-6,gl:null,flipMatrix:!0,fullScreenQuad:null,shaderPath:".",Primitives:{V2:function(t,e){return new SQR.V2(t,e)},V3:function(t,e,r){return new SQR.V3(t,e,r)},Q:function(t,e,r,n){return new SQR.Quaternion(t,e,r,n)},M4:function(){return new SQR.Matrix44},F:function(t){var e=function(t,r,n,i){var a=SQR.Face().v(t,r,n,i);return e.faces.push(a),a};return e.faces=[],e.toBuffer=function(r){var n=0;return e.faces.forEach(function(e){t&&t.reverseNormals&&e.flip(),e.calculateNormal(),n+=e.toBuffer(r,n)}),n},e}},v2:function(){return{aPosition:2}},v3:function(){return{aPosition:3}},v2u2:function(){return{aPosition:2,aUV:2}},v2c3:function(){return{aPosition:2,aColor:3}},v3n3:function(){return{aPosition:3,aNormal:3}},v3n3u2:function(){return{aPosition:3,aNormal:3,aUV:2}},WARN_UNIFORM_NOT_PRESENT:!1};SQR.Version={version:"3.0",build:119,date:"Aug 12th 2015"},SQR.Anm=function(){var t,e={},r=[],n=0,i=[],a=0,o=function(){return(new Date).getTime()},s=function(t){return 3*t*t-2*t*t*t},u=function(t){return t>=1?1:0>=t?0:t},h=function(){var t,e,s,h,c,f,l,d,R,v,m=this,x=[];m.setup=function(r,n,i){t=r,h=n,e=i.properties,s=i.duration,c=i.ease,l=null,d=null,R=!1};var p=function(){if(x.length=0,e&&!(e instanceof Array)){for(var r in e){var n=e[r];x.push(n instanceof Array?2==n.length?{name:r,from:n[0],to:n[1]}:{name:r,from:t[r],to:t[r]+n[0]}:{name:r,from:t[r],to:n})}f=x.length}R=!0},S=function(e){for(var r=0;f>r;r++){var n=x[r];t[n.name]=n.from+(n.to-n.from)*e}};m.update=function(t){var r=t-v;if(!(h>r))if(r>=s+h)e&&S(1),l&&l(1),m.cancel();else{R||p();var n=c((r-h)/s);n=u(n),e&&S(n),l&&l(n)}},m.onUpdate=function(t){return l=t,m},m.onEnd=function(t){return d=t,m},m.cancel=function(){var t=r.indexOf(m);if(-1!=t)return r.splice(t,1),n=r.length,-1==i.indexOf(m)&&i.push(m),d&&d(),m},m.start=function(){return v=o()-a,r.push(m),n=r.length,m}};return e.create=function(t,e){var r={properties:e,duration:t,ease:s};return r.setDuration=function(t){return r.duration=t,r},r.setEase=function(t){return r.ease=t,r},r.run=function(t,e){var n=i.shift()||new h;return n.setup(t,e||0,r),n.start(),n},r},e.update=function(){var e=o(),i=n;if(t&&e-t>250)return a+=e-t,void(t=e);for(;i--;)r[i].update(e-a);t=e},e.run=function(){requestAnimationFrame(e.run),e.update()},e}(),SQR.Buffer=function(){var t,e,r,n,i={},a=!1;return i.mode=SQR.gl.TRIANGLES,i.cull=!0,i.setMode=function(t){return i.mode=t,i},i.layout=function(e,r){i.size=r,i.strideSize=0,i.layout=e,i.attributes={};for(var n in e){var a={offset:i.strideSize,byteOffset:4*i.strideSize,size:e[n]};i.strideSize+=e[n],i.attributes[n]=a}return i.strideByteSize=4*i.strideSize,t=new Float32Array(r*i.strideSize),i},i.data=function(e,r){r instanceof Array||(r=Array.prototype.slice.call(arguments,1));for(var n=i.attributes[e],a=r.length/n.size,o=0;a>o;o++)for(var s=0;s<n.size;s++)t[o*i.strideSize+s+n.offset]=r[o*n.size+s];return i},i.set=function(e,r,n){n.toArray?n=n.toArray():n instanceof Array||(n=Array.prototype.slice.call(arguments,2));for(var a=i.attributes[e],o=0;o<a.size;o++)t[r*i.strideSize+o+a.offset]=n[o];return i},i.iterate=function(e,r){for(var n=i.attributes[e],a=e?n.offset:0,o=0,s=0;s<t.length;s+=i.strideSize)r(s+a,t,o),o++;return i},i.bind=function(){return SQR.gl.bindBuffer(SQR.gl.ARRAY_BUFFER,r),a&&SQR.gl.bindBuffer(SQR.gl.ELEMENT_ARRAY_BUFFER,n),i},i.update=function(){var o=SQR.gl;return r=r||o.createBuffer(),o.bindBuffer(o.ARRAY_BUFFER,r),o.bufferData(o.ARRAY_BUFFER,t,o.STATIC_DRAW),a&&(n=o.createBuffer(),o.bindBuffer(o.ELEMENT_ARRAY_BUFFER,n),o.bufferData(o.ELEMENT_ARRAY_BUFFER,e,o.STATIC_DRAW)),i},i.index=function(t){return t instanceof Array||(t=Array.prototype.slice.call(arguments,0)),e=new Uint16Array(t),i.indexSize=t.length,a=!0,i},i.isIndexed=function(){return a},i.draw=function(){var t=SQR.gl;i.cull?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),a?t.drawElements(i.mode,i.indexSize,t.UNSIGNED_SHORT,0):t.drawArrays(i.mode,0,i.size)},i.setRawData=function(e,r){t.set(e,r)},i.getDataArray=function(){return t},i.getIndexArray=function(){return e},i.destroy=function(){t.length=0,SQR.gl.deleteBuffer(r),a&&(e.length=0,SQR.gl.deleteBuffer(n))},i},SQR.Context=function(t){!SQR._versionDisplayed&&SQR.Version&&(console.log("Squareroot v"+SQR.Version.version+" b"+SQR.Version.build),SQR._versionDisplayed=!0);var e="> SQR.Context - Webgl is not supported.",r="> SQR.Context - Invalid canvas reference.";if(t||(t=document.createElement("canvas")),t instanceof HTMLElement||(t=document.querySelector(t)),!t.getContext)throw r;var n,i={canvas:t};return i.create=function(r,a){a=a||function(){throw e},r=r||{},void 0===r.antialias&&(r.antialias=!0),window.WebGLRenderingContext||a();try{n=t.getContext("webgl",r)||t.getContext("experimental-webgl",r)}catch(o){console.error(o),a()}return i.gl=n,i.setAsCurrent(),i},i.size=function(e,r,n){return n=n||1,t.width=e*n,t.height=r*n,i.viewport(0,0,e*n,r*n),t.style.width=e+"px",t.style.height=r+"px",i},i.viewport=function(t,e,r,a){return n.viewport(t,e,r,a),i},i.clearColor=function(t,e,r,a){return n.clearColor(t,e,r,a),i},i.clear=function(){return n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT),i},i.setAsCurrent=function(){return SQR.gl=n,i},i},SQR.Cubemap=function(t,e){var r={};r.tex=SQR.gl.createTexture();var n=6,i={};e=e||{};var a=function(){var t=SQR.gl;t.bindTexture(t.TEXTURE_CUBE_MAP,r.tex),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,i.right),t.texImage2D(t.TEXTURE_CUBE_MAP_NEGATIVE_X,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,i.left),t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_Y,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,i.up),t.texImage2D(t.TEXTURE_CUBE_MAP_NEGATIVE_Y,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,i.down),t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_Z,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,i.front),t.texImage2D(t.TEXTURE_CUBE_MAP_NEGATIVE_Z,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,i.back),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.generateMipmap(t.TEXTURE_CUBE_MAP),t.bindTexture(t.TEXTURE_CUBE_MAP,null),e.onLoad&&e.onLoad()},o=function(){n--,0>=n&&a()},s=function(t,e){"string"==typeof e?(i[t]=new Image,i[t].onload=o,i[t].src=e):(e instanceof Image||e.getContext)&&(i[t]=e,o())};return t.left?(s("left",t.left),s("right",t.right),s("up",t.up),s("down",t.down),s("back",t.back),s("front",t.front)):t&&(s("left",t),s("right",t),s("up",t),s("down",t),s("back",t),s("front",t)),r},SQR.FrameBuffer=function(t,e,r,n){r=r||1,t=t||window.innerWidth,e=e||window.innerHeight;var i={},a=SQR.gl;if(i.texture=a.createTexture(),i.depthBuffer=a.createRenderbuffer(),n){a.bindTexture(a.TEXTURE_CUBE_MAP,i.texture),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_CUBE_MAP,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE);for(var o=0;6>o;o++)a.texImage2D(a.TEXTURE_CUBE_MAP_POSITIVE_X+o,0,a.RGBA,t,e,0,a.RGBA,a.UNSIGNED_BYTE,null);a.bindRenderbuffer(a.RENDERBUFFER,i.depthBuffer),a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_COMPONENT16,t,e);var s=function(t){var e=a.createFramebuffer();return a.bindFramebuffer(a.FRAMEBUFFER,e),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+t,i.texture,0),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,i.depthBuffer),a.bindFramebuffer(a.FRAMEBUFFER,null),e};i.faces={right:s(0),left:s(1),up:s(2),down:s(3),front:s(4),back:s(5)},a.bindTexture(a.TEXTURE_2D,null),a.bindRenderbuffer(a.RENDERBUFFER,null)}else i.fbo=a.createFramebuffer(),a.bindFramebuffer(a.FRAMEBUFFER,i.fbo),a.bindTexture(a.TEXTURE_2D,i.texture),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,t,e,0,a.RGBA,a.UNSIGNED_BYTE,null),a.bindRenderbuffer(a.RENDERBUFFER,i.depthBuffer),a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_COMPONENT16,t,e),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,i.texture,0),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,i.depthBuffer),a.bindTexture(a.TEXTURE_2D,null),a.bindRenderbuffer(a.RENDERBUFFER,null),a.bindFramebuffer(a.FRAMEBUFFER,null);return i.bind=function(r){var n=i.faces?i.faces[r]:i.fbo;a.viewport(0,0,t,e),a.bindFramebuffer(a.FRAMEBUFFER,n)},i.unbind=function(){a.bindFramebuffer(a.FRAMEBUFFER,null)},i.resize=function(n,o){t=n*r|0,e=o*r|0,a.bindFramebuffer(a.FRAMEBUFFER,i.fbo),a.bindTexture(a.TEXTURE_2D,i.texture),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,t,e,0,a.RGBA,a.UNSIGNED_BYTE,null),a.bindRenderbuffer(a.RENDERBUFFER,i.depthBuffer),a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_COMPONENT16,t,e),a.bindFramebuffer(a.FRAMEBUFFER,null),a.bindRenderbuffer(a.RENDERBUFFER,null)},i},SQR.Loader={loadText:function(t,e){var r=new XMLHttpRequest;r.open("GET",t);var n=function(){4==r.readyState&&(r.removeEventListener("readystatechange",n),e(r.responseText,t))};r.addEventListener("readystatechange",n),r.send()},loadJSON:function(t,e){SQR.Loader.loadText(t,function(r){e(JSON.parse(r),t)})},loadImage:function(t,e){var r=new Image;if(e){var n=function(){r.removeEventListener("load",n),e(r,t)};r.addEventListener("load",n)}return r.src=t,r},loadWebcam:function(t,e){navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia,navigator.getUserMedia||(console.error("> SQR.Loader - getUserMedia not supported"),t()),e=e||{audio:!1,video:{}};var r=function(t){i.stream=t,i.src=window.URL.createObjectURL(t),i.play(),i.addEventListener("canplaythrough",n,!1)},n=function(){t(i,"webcam")},i=document.createElement("video");i.autoplay=!0,navigator.getUserMedia(e,r,function(t){console.error("> SQR.Loader - getUserMedia error ",t)})},loadVideo:function(t,e){var r=function(){e(n,t)},n=document.createElement("video");n.autoplay=!0,n.addEventListener("canplaythrough",r,!1);var i=t;n.canPlayType("video/mp4")||(i=i.replace("mp4","webm")),n.src=i},loadAssets:function(t,e,r){var n=t.length;SQR.Loader.assets={};for(var i={},a={},o=function(a,o){SQR.Loader.assets[i[o]]=a,n--,r&&r(n,t.length),0==n&&e(SQR.Loader.assets)},s=0;n>s;s++){var u=t[s],h="string"!=typeof u,c=h?u[0]:u,f=h?u[1]:u,l=c.substring(c.lastIndexOf(".")+1);if(c.indexOf("~")>-1){if(SQR.GLSL&&SQR.GLSL[c.substring(2)]){n--;continue}var d=c.replace("~",SQR.shaderPath);a[d]=c,c=d}switch(i[c]=f,l){case"glsl":SQR.Loader.loadText(c,o);break;case"png":case"jpg":case"gif":SQR.Loader.loadImage(c,o);break;case"json":case"js":SQR.Loader.loadJSON(c,o);break;case"mp4":case"webm":SQR.Loader.loadVideo(c,o);break;case"webcam":SQR.Loader.loadWebcam(o)}}}},SQR.Renderer=function(t){var e,r,n,i,a={},o=[],s=[],u=function(t){if(t.active){if(t.transformWorld(),t.numChildren>0)for(var e=0;e<t.numChildren;e++)u(t.children[e]);t.transparent?s.push(t):t.useDepth?o.push(t):o.unshift(t)}},h={};return a.autoClear=!0,a.render=function(c,f,l){var d=SQR.gl;e||(e=(new Date).getTime()),r=(new Date).getTime()-e,a.currentTime=r,l=l||h,!l.dontClear&&a.autoClear&&t.clear(),d.disable(d.BLEND),d.enable(d.DEPTH_TEST),d.enable(d.CULL_FACE),d.frontFace(d.CW),o.length=0,s.length=0,u(c),f&&f.computeInverseMatrix(),o=o.concat(s);var R,v=o.length,m=null,x=null,p=!1,S=l&&l.replacementShader;S&&(x=l.replacementShader.use());for(var E=0;v>E;E++){n=!1,i=!1;var R=o[E];if(R.transformView(f?f.inverseWorldMatrix:null),R.buffer){if(R.transparent&&(p||(d.enable(d.BLEND),p=!0),d.blendFunc(R.srcFactor,R.dstFactor)),m!=R.buffer&&(m=R.buffer,m.bind(),i=!0),x!=R.shader&&!S){x=R.shader.use().updateTextures(),f&&x.setUniform("uEyePosition",f.globalPosition);var y=f&&f.projection?f.projection:a.projection;y&&x.setUniform("uProjection",y),x.setUniform("uTime",r),n=!0}(n||i)&&x.attribPointers(m),R.draw(l)}}},a.renderToScreen=function(){var t=SQR.gl;t.bindFramebuffer(t.FRAMEBUFFER,null)},a},SQR.Shader=function(t,e){var r,n={},i={},a=[],o={},s=[],u=[],h=function(t){if(!t)throw"> SQR.Shader.parseGLSL - Shader source code missing";var r="",n=e?e.directives:null;if(n&&n instanceof Array)for(var i=0;i<n.length;i++)r+="#define "+n[i].name,n[i].value&&(r+=" "+n[i].value),r+="\n";for(var a=r,o=r,s=!0,u=t.split("\n"),i=0;i<u.length;i++){var h=u[i];if(h.indexOf("//#include")>-1){var c,f=h.substring(11);if(c=SQR.GLSL&&SQR.GLSL[f.substring(1)]?SQR.GLSL[f.substring(1)]:SQR.Loader.assets[f],!c)throw"> SQR.Shader.parseGLSL - Include not found "+f;u[i]=c}}for(var u=u.join("\n").split("\n"),i=0;i<u.length;i++){var h=u[i];if(h.indexOf("//#")>-1)h.indexOf("//#fragment")>-1?s=!1:h.indexOf("//#vertex")>-1&&(s=!0);else{if(h.indexOf("//")>-1&&(h=h.substring(0,h.indexOf("//"))),h.match(/^([\s\t]*)$/))continue;s?a+=h+"\n":o+=h+"\n"}}return{vertex:a,fragment:o}};n.compile=function(){var e=t=h(t),i=SQR.gl,a=i.createShader(i.VERTEX_SHADER);i.shaderSource(a,e.vertex),i.compileShader(a);var o=i.createShader(i.FRAGMENT_SHADER);if(i.shaderSource(o,e.fragment),i.compileShader(o),r=i.createProgram(),i.attachShader(r,a),i.attachShader(r,o),i.linkProgram(r),!i.getShaderParameter(a,i.COMPILE_STATUS))throw"> SQR.Shader. Vertex shader compile error: "+i.getShaderInfoLog(a);if(!i.getShaderParameter(o,i.COMPILE_STATUS))throw"> SQR.Shader. Fragment shader compile error: "+i.getShaderInfoLog(o);if(!i.getProgramParameter(r,i.LINK_STATUS))throw"> SQR.Shader. Shader linking error: "+i.getProgramInfoLog(r);return n},n.inspect=function(){for(var t=SQR.gl,e=t.getProgramParameter(r,t.ACTIVE_ATTRIBUTES),h=0;e>h;h++){var c=t.getActiveAttrib(r,h);c.location=t.getAttribLocation(r,c.name),i[c.name]=c,a.push(c)}for(var f=t.getProgramParameter(r,t.ACTIVE_UNIFORMS),l=0,h=0;f>h;h++){var d=t.getActiveUniform(r,h);if((d.type==t.SAMPLER_2D||d.type==t.SAMPLER_CUBE)&&(d.texId=l++,u.push(d)),d.name.indexOf("[")>-1)for(var R=d.name.substring(0,d.name.indexOf("[")),v=1;v<d.size;v++){var m=R+"["+v+"]",x={name:m,location:t.getUniformLocation(r,m),type:d.type};o[x.name]=x,s.push(x)}d.location=t.getUniformLocation(r,d.name),o[d.name]=d,s.push(d)}return n};var c="string";n.getUniform=function(t){return o[t]},n.hasUniform=function(t){return null!=o[t]},n.setUniform=function(t,e){var r=SQR.gl,i=typeof t==c?o[t]:t,a=e;if(!i){var s=o[t+"[0]"];if(s){for(var u=0;u<s.size;u++)e[u]&&n.setUniform(t+"["+u+"]",e[u]);return}return SQR.WARN_UNIFORM_NOT_PRESENT&&(console.warn("> SQR.Shader attempt to set uniform that does not exist: "+t),console.trace()),n}switch(a.toUniform&&(a=a.toUniform(i.type)),i.type){case r.BYTE:r.uniform1i(i.location,a);break;case r.UNSIGNED_BYTE:r.uniform1i(i.location,a);break;case r.SHORT:r.uniform1i(i.location,a);break;case r.UNSIGNED_SHORT:r.uniform1i(i.location,a);break;case r.INT:r.uniform1i(i.location,a);break;case r.INT_VEC2:r.uniform2iv(i.location,a);break;case r.INT_VEC3:r.uniform3iv(i.location,a);break;case r.INT_VEC4:r.uniform4iv(i.location,a);break;case r.UNSIGNED_INT:r.uniform1i(i.location,a);break;case r.FLOAT:r.uniform1f(i.location,a);break;case r.FLOAT_VEC2:r.uniform2fv(i.location,a);break;case r.FLOAT_VEC3:r.uniform3fv(i.location,a);break;case r.FLOAT_VEC4:r.uniform4fv(i.location,a);break;case r.BOOL:r.uniform1i(i.location,a);break;case r.BOOL_VEC2:r.uniform2iv(i.location,a);break;case r.BOOL_VEC3:r.uniform3iv(i.location,a);break;case r.BOOL_VEC4:r.uniform4iv(i.location,a);break;case r.FLOAT_MAT2:r.uniformMatrix2fv(i.location,!1,a.data||a);break;case r.FLOAT_MAT3:r.uniformMatrix3fv(i.location,!1,a.data||a);break;case r.FLOAT_MAT4:r.uniformMatrix4fv(i.location,!1,a.data||a);break;case r.SAMPLER_2D:f(i,a);break;case r.SAMPLER_CUBE:l(i,a);break;default:console.warn("> SQR.Shader > WARNING! Unknown uniform type ( 0x"+i.type.toString(16)+" )")}return n};var f=function(t,e){var r=SQR.gl,n=t.texId;t.texref=e,r.activeTexture(r.TEXTURE0+n),r.bindTexture(r.TEXTURE_2D,e.tex||e),e.isAnimated&&e.update(),r.uniform1i(t.location,n)},l=function(t,e){var r=SQR.gl,n=t.texId;t.texref=e,r.activeTexture(r.TEXTURE0+n),r.bindTexture(r.TEXTURE_CUBE_MAP,e.tex||e),r.uniform1i(t.location,n)};return n.updateTextures=function(){for(var t=(SQR.gl,0),e=u.length;e>t;t++){var r=u[t];r.texref&&n.setUniform(r,r.texref)}return n},n.use=function(){return SQR.gl.useProgram(r),n},n.attribPointers=function(t){var e=SQR.gl,r=a.length;t=t.buffer||t;for(var i=0;r>i;i++){var o=a[i],s=t.attributes[o.name];if(!s)throw"> SQR.Shader expects attribute "+o.name+" but geometry doesn't provide it";o.enabled||e.enableVertexAttribArray(o.location),e.vertexAttribPointer(o.location,s.size,e.FLOAT,!1,t.strideByteSize,s.byteOffset),o.enabled=!0}return n},e&&e.doNotCompile||(n.compile(),n.inspect()),n},SQR.Texture=function(t,e){e=e||{};var r,n={},i=SQR.gl;n.setSource=function(t){if(!(t instanceof HTMLVideoElement||t instanceof Image||t instanceof HTMLCanvasElement))throw console.error("Invalid source: "+s),"SQR.Texture > provided source is not a valid source for texture";return r=t,n.isAnimated=e&&e.isAnimated||t instanceof HTMLVideoElement,n},n.setSource(t);var a=i.createTexture(),o=function(){var t=r.width,e=r.height;return t>0&&e>0&&0==(t&t-1)&&0==(e&e-1)};n.update=function(){var t=SQR.gl;return t.bindTexture(t.TEXTURE_2D,a),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r),n};var u=e.wrapS||e.wrap||i.CLAMP_TO_EDGE,h=e.wrapT||e.wrap||i.CLAMP_TO_EDGE;i.bindTexture(i.TEXTURE_2D,a),i.pixelStorei(i.UNPACK_FLIP_Y_WEBGL,!0),i.texImage2D(i.TEXTURE_2D,0,i.RGBA,i.RGBA,i.UNSIGNED_BYTE,r);var c,f;return o()?(e.mipmap&&i.generateMipmap(i.TEXTURE_2D),c=e.mipmap?i.LINEAR_MIPMAP_LINEAR:i.LINEAR,f=i.LINEAR):c=f=i.LINEAR,i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,f),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,c),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,u),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,h),i.bindTexture(i.TEXTURE_2D,null),n.tex=a,n},SQR.Transform=function(t,e){var r={},n=0;return r.uid=e,r.name=t||"sqr.transform."+SQR.TransformCount++,r.active=!0,r.directMatrixMode=!1,r.matrix=new SQR.Matrix44,r.position=new SQR.V3,r.globalPosition=new SQR.V3,r.forward=new SQR.V3,r.quaternion=new SQR.Quaternion,r.rotation=new SQR.V3,r.scale=new SQR.V3(1,1,1),r.useQuaternion=!1,r.isStatic=!1,r.normalMatrix=new SQR.Matrix33,r.globalMatrix=new SQR.Matrix44,r.viewMatrix=new SQR.Matrix44,r.inverseWorldMatrix,r.boneMatrix=new SQR.Matrix44,r.poseMatrix=new SQR.Matrix44,r.inversePoseMatrix=new SQR.Matrix44,r.lookAt=null,r.transparent=!1,r.srcFactor=null,r.dstFactor=null,r.useDepth=!0,r.lineWidth=1,r.setAsBoneRoot=function(){r.computePoseMatrix()},r.computePoseMatrix=function(){r.bone=!0,r.transformWorld(),r.parent&&r.parent.bone?(r.parent.poseMatrix.copyTo(r.poseMatrix),r.poseMatrix.multiply(r.matrix)):r.matrix.copyTo(r.poseMatrix);for(var t=0;t<r.numChildren;t++){var e=r.children[t];e.computePoseMatrix()}return r.poseMatrix.inverse(r.inversePoseMatrix),r},r.setBlending=function(t,e,n){r.transparent=t,r.srcFactor=e||SQR.gl.SRC_ALPHA,r.dstFactor=n||SQR.gl.ONE_MINUS_SRC_ALPHA},r.children=[],r.numChildren=0,r.add=function(){for(var t=0;t<arguments.length;t++){var e=arguments[t];e.parent=r,-1==r.children.indexOf(e)&&r.children.push(e)}return r.numChildren=r.children.length,r},r.remove=function(){for(var t=0;t<arguments.length;t++){var e=arguments[t],n=r.children.indexOf(e);-1!=n&&(e.parent=null,r.children.splice(n,1))}return r.numChildren=r.children.length,r},r.removeAll=function(){r.children.length=0,r.numChildren=0},r.contains=function(t){return r.children.indexOf(t)>-1},r.recurse=function(t,e){e||t(r);for(var n=0;n<r.numChildren;n++)r.children[n].recurse(t)},r.findByName=function(t){var e;return r.recurse(function(r){return r.name==t?void(e=r):void 0}),e},r.findById=function(t){var e;return r.recurse(function(r){return r.uid&&r.uid==t?void(e=r):void 0}),e},r.draw=function(t){var e=t&&t.replacementShader,n=e?t.replacementShader:r.shader;if(n.setUniform("uMatrix",r.globalMatrix),n.setUniform("uViewMatrix",r.viewMatrix),n.setUniform("uNormalMatrix",r.normalMatrix),!e&&n.uniforms)for(var i=Object.keys(n.uniforms),a=0,o=i.length;o>a;a++)n.setUniform(i[a],n.uniforms[i[a]]);if(!e&&r.uniforms)for(var i=Object.keys(r.uniforms),a=0,o=i.length;o>a;a++)n.setUniform(i[a],r.uniforms[i[a]]);var s=SQR.gl;r.useDepth?s.enable(s.DEPTH_TEST):s.disable(s.DEPTH_TEST),s.lineWidth(r.lineWidth),r.buffer.draw()},r.transformWorld=function(){if(1!=n){if(!r.directMatrixMode){var t=r.position,e=r.scale;if(r.useQuaternion){var i=r.quaternion;r.matrix.setTQS(t.x,t.y,t.z,i.w,i.x,i.y,i.z,e.x,e.y,e.z)}else{var a=r.rotation;r.matrix.setTRS(t.x,t.y,t.z,a.x,a.y,a.z,e.x,e.y,e.z)}}r.lookAt&&r.matrix.lookAt(r.lookAt.position),r.parent?(r.parent.globalMatrix.copyTo(r.globalMatrix),r.globalMatrix.multiply(r.matrix),r.bone&&(r.parent.boneMatrix.copyTo(r.boneMatrix),r.boneMatrix.multiply(r.matrix))):(r.matrix.copyTo(r.globalMatrix),r.bone&&r.matrix.copyTo(r.boneMatrix));var o=r.globalMatrix;o.extractPosition(r.globalPosition),r.forward.set(o.data[8],o.data[9],o.data[10]),r.isStatic&&(n=1),r.beforeDraw&&r.beforeDraw()}},r.viewDepth=function(){return r.viewMatrix.data[14]},r.transformView=function(t){t?(t.copyTo(r.viewMatrix),r.viewMatrix.multiply(r.globalMatrix),r.viewMatrix.inverseMat3(r.normalMatrix)):(r.globalMatrix.copyTo(r.viewMatrix),r.viewMatrix.inverseMat3(r.normalMatrix))},r.computeInverseMatrix=function(){return r.inverseWorldMatrix||(r.inverseWorldMatrix=new SQR.Matrix44),r.globalMatrix.inverse(r.inverseWorldMatrix),r.inverseWorldMatrix},r.computeBoneMatrix=function(){return r.boneMatrix.multiply(r.inversePoseMatrix),r.boneMatrix},r},SQR.TransformCount=0,SQR.Bezier=function(t,e,r,n){var i=this;this.p0=t,this.c0=e,this.c1=r,this.p1=n;var a,o,s,u=SQR.Interpolation.bezierPosition,h=SQR.Interpolation.bezierVelocity;this.velocityAt=function(t,e){return o=o||this.p0.clone().set(),e=e||o,e.x=h(t,this.p0.x,this.c0.x,this.c1.x,this.p1.x),e.y=h(t,this.p0.y,this.c0.y,this.c1.y,this.p1.y),null!==e.z&&null!==this.p0.z&&(e.z=h(t,this.p0.z,this.c0.z,this.c1.z,this.p1.z)),e},this.valueAt=function(t,e){return a=a||this.p0.clone().set(),e=e||a,e.x=u(t,this.p0.x,this.c0.x,this.c1.x,this.p1.x),e.y=u(t,this.p0.y,this.c0.y,this.c1.y,this.p1.y),null!==e.z&&null!==this.p0.z&&(e.z=u(t,this.p0.z,this.c0.z,this.c1.z,this.p1.z)),e},this.matrixAt=function(t,e){s=s||new SQR.Matrix44,e=e||s,e.identity();var r=i.valueAt(t),n=i.velocityAt(t).norm(),a=SQR.V3.__tv1.set().cross(n,SQR.V3.up),o=SQR.V3.__tv2.set().cross(n,a);return e.data[0]=a.x,e.data[4]=o.x,e.data[8]=n.x,e.data[1]=a.y,e.data[5]=o.y,e.data[9]=n.y,e.data[2]=a.z,e.data[6]=o.z,e.data[10]=n.z,e.setTranslation(r.x,r.y,r.z),e}},SQR.Color=function(){var t,e={};return e.setRGB=function(t,r,n){return e.r=t||0,e.g=r||0,e.b=n||0,e},e.setHex=function(t){return t=0==t.indexOf("#")?t.substring(1):t,t=-1==t.indexOf("0x")?"0x"+t:t,t=parseInt(t),e.r=(t>>16&255)/255,e.g=(t>>8&255)/255,e.b=(255&t)/255,e},e.copyFrom=function(t){return e.r=t.r,e.g=t.g,e.b=t.b,e},e.lighten=function(t){return e.r=Math.min(1,e.r*t),e.g=Math.min(1,e.g*t),e.b=Math.min(1,e.b*t),e},e.clone=function(){return(new SQR.Color).setRGB(e.r,e.g,e.b)},e.mul=function(t){return e.r=Math.min(1,e.r*t),e.g=Math.min(1,e.g*t),e.b=Math.min(1,e.b*t),e},e.toUniform=function(){return t||(t=new Float32Array(3)),t[0]=e.r,t[1]=e.g,t[2]=e.b,t},e},SQR.Delaunay=function(){function t(t,e){var n=[];return e=e.filter(function(e){return e.vertexInCircumcircle(t)?(n.push(new r(e.v0,e.v1)),n.push(new r(e.v1,e.v2)),n.push(new r(e.v2,e.v0)),!1):!0}),n=i(n),n.forEach(function(r){e.push(new SQR.Triangle(r.v0,r.v1,t))}),e}var e={},r=function(t,e){this.v0=t,this.v1=e};r.prototype.equals=function(t){return this.v0===t.v0&&this.v1===t.v1},r.prototype.inverse=function(){return new r(this.v1,this.v0)};var n=function(t){var e,r,n,i;t.forEach(function(t){(void 0===e||t.x<e)&&(e=t.x),(void 0===r||t.y<r)&&(r=t.y),(void 0===n||t.x>n)&&(n=t.x),(void 0===i||t.y>i)&&(i=t.y)});var a=10*(n-e),o=10*(i-r),s=new SQR.V2(e-a,r-3*o),u=new SQR.V2(e-a,i+o),h=new SQR.V2(n+3*a,i+o);return new SQR.Triangle(s,u,h)},i=function(t){for(var e=[],r=0;r<t.length;++r){for(var n=t[r],i=!0,a=0;a<t.length;++a)if(r!==a){var o=t[a];if(n.equals(o)||n.inverse().equals(o)){i=!1;break}}i&&e.push(n)}return e};return e.triangulate=function(e){var r=[],i=n(e);return r.push(i),e.forEach(function(e){r=t(e,r)}),r=r.filter(function(t){return!(t.v0==i.v0||t.v0==i.v1||t.v0==i.v2||t.v1==i.v0||t.v1==i.v1||t.v1==i.v2||t.v2==i.v0||t.v2==i.v1||t.v2==i.v2)})},e}(),SQR.Interpolation={bezierPosition:function(t,e,r,n,i){return e*(1-t)*(1-t)*(1-t)+3*r*t*(1-t)*(1-t)+3*n*t*t*(1-t)+i*t*t*t},bezierVelocity:function(t,e,r,n,i){return 3*r-3*e+2*(3*e-6*r+3*n)*t+3*(-e+3*r-3*n+i)*t*t},linear:function(t,e,r){return t>=r?t:r>=e?e:(r=(r-t)/(e-t),t+(e-t)*r)},smoothStep:function(t){return 3*t*t-2*t*t*t},quadIn:function(t){return t*t},quadOut:function(t){return t*(2-t)},quadInOut:function(t){return(t*=2)<1?.5*t*t:-.5*(--t*(t-2)-1)}},Math.clamp=function(t,e,r){return e>=t?e:t>=r?r:t},Math.clamp01=function(t){return 0>=t?0:t>=1?1:t},Math.getBoundsAtDistance=function(t,e,r,n){r=r||window.innerWidth,n=n||window.innerHeight;var i=r/n,a=Math.tan(t/180*Math.PI/2),o=e*a,s=o*i;return{w:s,h:o}},SQR.Matrix2D=function(){this.data=new Float32Array(9);var t,e,r,n,i;this.identity=function(t){return t=t||this.data,t[0]=1,t[3]=0,t[6]=0,t[1]=0,t[4]=1,t[7]=0,t[2]=0,t[5]=0,t[8]=1,this},this.transformVector=function(t){return r=this.data,n=t.x,i=t.y,t.x=r[0]*n+r[1]*i+r[2],t.y=r[3]*n+r[4]*i+r[5],t},this.setTranslation=function(t,e,n){return r=n||this.data,r[0]=1,r[3]=0,r[6]=t,r[1]=0,r[4]=1,r[7]=e,r[2]=0,r[5]=0,r[8]=1,this},this.getTranslation=function(t){return r=this.data,t=t||new SQR.V2,t.x=r[2],t.y=r[5],t},this.setScale=function(t,e,n){return r=n||this.data,r[0]=t,r[3]=0,r[6]=0,r[1]=0,r[4]=e,r[7]=0,r[2]=0,r[5]=0,r[8]=1,this},this.setShear=function(t,e,n){return r=n||this.data,r[0]=1,r[3]=t,r[6]=0,r[1]=e,r[4]=1,r[7]=0,r[2]=0,r[5]=0,r[8]=1,this},this.setRotation=function(t,e){r=e||this.data;var n=Math.cos(t),i=Math.sin(t);return r[0]=n,r[3]=-i,r[6]=0,r[1]=i,r[4]=n,r[7]=0,r[2]=0,r[5]=0,r[8]=1,this},this.setTRS=function(t,e,n,i,a){r=this.data;var o=Math.cos(n),s=Math.sin(n);return r[0]=o*i,r[3]=-s*a,r[6]=t,r[1]=s*i,r[4]=o*a,r[7]=e,r[2]=0,r[5]=0,r[8]=1,this},this.translate=function(t,e){return this.identity(SQR.Matrix2D.__temp),this.setTranslation(t,e,SQR.Matrix2D.__temp),this.multiply(SQR.Matrix2D.__temp)},this.rotate=function(t){return this.identity(SQR.Matrix2D.__temp),this.setRotation(t,SQR.Matrix2D.__temp),this.multiply(SQR.Matrix2D.__temp)},this.scale=function(t,e){return this.identity(SQR.Matrix2D.__temp),this.setScale(t,e,SQR.Matrix2D.__temp),this.multiply(SQR.Matrix2D.__temp)},this.shear=function(t,e){return this.identity(SQR.Matrix2D.__temp),this.setRotation(t,e,SQR.Matrix2D.__temp),this.multiply(SQR.Matrix2D.__temp)};var a,o,s,u,h,c,f,l,d,R,v,m,x,p,S,E,y,T;this.multiply=function(r){return t=this.data,e=r.data||r,a=t[0],o=t[3],s=t[6],u=t[1],h=t[4],c=t[7],f=t[2],l=t[5],d=t[8],R=e[0],v=e[3],m=e[6],x=e[1],p=e[4],S=e[7],E=e[2],y=e[5],T=e[8],t[0]=a*R+o*x+s*E,t[3]=a*v+o*p+s*y,t[6]=a*m+o*S+s*T,t[1]=u*R+h*x+c*E,t[4]=u*v+h*p+c*y,t[7]=u*m+h*S+c*T,this},this.copyTo=function(r){return t=this.data,e=r.data||r,e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],r},this.copyFrom=function(r){return t=r.data||r,e=this.data,e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],this},this.identity()},SQR.Matrix2D.__temp=new Float32Array(9),SQR.Matrix33=function(){this.data=new Float32Array(9),this.identity=function(){var t=this.data;return t[0]=1,t[3]=0,t[6]=0,t[1]=0,t[4]=1,t[7]=0,t[2]=0,t[5]=0,t[8]=1,this},this.transformVector=function(t,e){var r=this.data,n=t.x,i=t.y,a=t.z;return e=e||t,e.x=r[0]*n+r[3]*i+r[6]*a,e.y=r[1]*n+r[4]*i+r[7]*a,e.z=r[2]*n+r[5]*i+r[8]*a,e},this.determinant=function(){var t=this.data;return t[0]*(t[4]*t[8]-t[7]*t[5])+t[3]*(t[7]*t[2]-t[1]*t[8])+t[6]*(t[1]*t[5]-t[4]*t[2])},this.inverse=function(t){var e=this.data;t=t||this.data;var r,n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],h=e[6],c=e[7],f=e[8],l=f*s-u*c,d=-f*o+u*h,R=c*o-s*h,e=n*l+i*d+a*R;return e?(r=1/e,t[0]=l*r,t[1]=(-f*i+a*c)*r,t[2]=(u*i-a*s)*r,t[3]=d*r,t[4]=(f*n-a*h)*r,t[5]=(-u*n+a*o)*r,t[6]=R*r,t[7]=(-c*n+i*h)*r,t[8]=(s*n-i*o)*r,t):(console.warn("Attempt to inverse a singular matrix33. ",this.data),t)},this.transpose=function(){var t=this.data,e=t[0],r=t[3],n=t[6],i=t[1],a=t[4],o=t[7],s=t[2],u=t[5],h=t[8];t[0]=e,t[1]=r,t[2]=n,t[3]=i,t[4]=a,t[5]=o,t[6]=s,t[7]=u,t[8]=h}},SQR.Matrix44=function(t){this.data=t||new Float32Array(16),this.identity=function(t){var e=t||this.data;return e[0]=1,e[4]=0,e[8]=0,e[12]=0,e[1]=0,e[5]=1,e[9]=0,e[13]=0,e[2]=0,e[6]=0,e[10]=1,e[14]=0,e[3]=0,e[7]=0,e[11]=0,e[15]=1,this},this.transformVector=function(t,e){var r=this.data,n=t.x,i=t.y,a=t.z,o=t.w;return e=e||t,e.x=r[0]*n+r[4]*i+r[8]*a+r[12]*o,e.y=r[1]*n+r[5]*i+r[9]*a+r[13]*o,e.z=r[2]*n+r[6]*i+r[10]*a+r[14]*o,e},this.rotateVector=function(t,e){{var r=this.data,n=t.x,i=t.y,a=t.z;t.w}return e=e||t,e.x=r[0]*n+r[4]*i+r[8]*a,e.y=r[1]*n+r[5]*i+r[9]*a,e.z=r[2]*n+r[6]*i+r[10]*a,e},this.multiply=function(t){var e,r,n,i,a,o,s,u,h,c,f,l,d,R,v,m,x,p,S,E,y,T,Q,_,g,M,A,b,w,U,F,P,z=this.data,B=t.data||t;return e=z[0],r=z[1],n=z[2],i=z[3],a=z[4],o=z[5],s=z[6],u=z[7],h=z[8],c=z[9],f=z[10],l=z[11],d=z[12],R=z[13],v=z[14],m=z[15],x=B[0],p=B[1],S=B[2],E=B[3],y=B[4],T=B[5],Q=B[6],_=B[7],g=B[8],M=B[9],A=B[10],b=B[11],w=B[12],U=B[13],F=B[14],P=B[15],z[0]=e*x+a*p+h*S+d*E,z[1]=r*x+o*p+c*S+R*E,z[2]=n*x+s*p+f*S+v*E,z[3]=i*x+u*p+l*S+m*E,z[4]=e*y+a*T+h*Q+d*_,z[5]=r*y+o*T+c*Q+R*_,z[6]=n*y+s*T+f*Q+v*_,z[7]=i*y+u*T+l*Q+m*_,z[8]=e*g+a*M+h*A+d*b,z[9]=r*g+o*M+c*A+R*b,z[10]=n*g+s*M+f*A+v*b,z[11]=i*g+u*M+l*A+m*b,z[12]=e*w+a*U+h*F+d*P,z[13]=r*w+o*U+c*F+R*P,z[14]=n*w+s*U+f*F+v*P,z[15]=i*w+u*U+l*F+m*P,this},this.setTQS=function(t,e,r,n,i,a,o,s,u,h,c){var f=c||this.data;this.identity(c);var l=i*i,d=a*a,R=o*o;return SQR.flipMatrix?(f[0]=(1-2*d-2*R)*s,f[1]=(2*i*a-2*o*n)*s,f[2]=(2*i*o+2*a*n)*s,f[4]=(2*i*a+2*o*n)*u,f[5]=(1-2*l-2*R)*u,f[6]=(2*a*o-2*i*n)*u,f[8]=(2*i*o-2*a*n)*h,f[9]=(2*a*o+2*i*n)*h,f[10]=(1-2*l-2*d)*h):(f[0]=(1-2*d-2*R)*s,f[4]=(2*i*a-2*o*n)*s,f[8]=(2*i*o+2*a*n)*s,f[1]=(2*i*a+2*o*n)*u,f[5]=(1-2*l-2*R)*u,f[9]=(2*a*o-2*i*n)*u,f[2]=(2*i*o-2*a*n)*h,f[6]=(2*a*o+2*i*n)*h,f[10]=(1-2*l-2*d)*h),f[12]=t,f[13]=e,f[14]=r,c||this},this.setTRS=function(t,e,r,n,i,a,o,s,u,h){var c=h||this.data;this.identity(h);var f=Math.sin(n),l=Math.cos(n),d=Math.sin(i),R=Math.cos(i),v=Math.sin(a),m=Math.cos(a);return SQR.flipMatrix?(c[0]=(R*m+d*f*v)*o,c[1]=(-R*v+d*f*m)*o,c[2]=d*l*o,c[4]=v*l*s,c[5]=m*l*s,c[6]=-f*s,c[8]=(-d*m+R*f*v)*u,c[9]=(v*d+R*f*m)*u,c[10]=R*l*u):(c[0]=(R*m+d*f*v)*o,c[4]=(-R*v+d*f*m)*o,c[8]=d*l*o,c[1]=v*l*s,c[5]=m*l*s,c[9]=-f*s,c[2]=(-d*m+R*f*v)*u,c[6]=(v*d+R*f*m)*u,c[10]=R*l*u),c[12]=t,c[13]=e,c[14]=r,h||this},this.setScale=function(t,e,r,n){var i=n||this.data;return i[0]=t,i[5]=e,i[10]=r,n||this},this.setTranslation=function(t,e,r,n){var i=n||this.data;return i[12]=t,i[13]=e,i[14]=r,n||this},this.setRotation=function(t,e,r,n){var i=n||this.data,a=Math.sin(t),o=Math.cos(t),s=Math.sin(e),u=Math.cos(e),h=Math.sin(r),c=Math.cos(r);return i[0]=u*c+s*a*h,i[1]=-u*h+s*a*c,i[2]=s*o,i[4]=h*o,i[5]=c*o,i[6]=-a,i[8]=-s*c+u*a*h,i[9]=h*s+u*a*c,i[10]=u*o,n||this},this.translate=function(t,e,r){return this.identity(SQR.Matrix44.__temp),this.setTranslation(t,e,r,SQR.Matrix44.__temp),this.multiply(SQR.Matrix44.__temp)},this.rotate=function(t,e,r){return this.identity(SQR.Matrix44.__temp),this.setRotation(t,e,r,SQR.Matrix44.__temp),this.multiply(SQR.Matrix44.__temp)},this.scale=function(t,e,r){return this.identity(SQR.Matrix44.__temp),this.setScale(t,e,r,SQR.Matrix44.__temp),this.multiply(SQR.Matrix44.__temp)
},this.copyTo=function(t){for(var e=this.data,r=t.data||t,n=0;16>n;n++)r[n]=e[n];return t},this.copyRotationTo=function(t){var e=this.data,r=t.data||t;return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[4],r[4]=e[5],r[5]=e[6],r[6]=e[8],r[7]=e[9],r[8]=e[10],t},this.extractPosition=function(t){var e=this.data;return t.set(e[12],e[13],e[14]),t},this.determinant=function(){var t=this.data;return t[0]*(t[5]*t[10]-t[9]*t[6])+t[4]*(t[9]*t[2]-t[1]*t[10])+t[8]*(t[1]*t[6]-t[5]*t[2])},this.inverse=function(t){var e=this.data,r=t?t.data||t:this.data,n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],h=e[6],c=e[7],f=e[8],l=e[9],d=e[10],R=e[11],v=e[12],m=e[13],x=e[14],p=e[15],S=n*u-i*s,E=n*h-a*s,y=n*c-o*s,T=i*h-a*u,Q=i*c-o*u,_=a*c-o*h,g=f*m-l*v,M=f*x-d*v,A=f*p-R*v,b=l*x-d*m,w=l*p-R*m,U=d*p-R*x,F=S*U-E*w+y*b+T*A-Q*M+_*g;return F?(F=1/F,r[0]=(u*U-h*w+c*b)*F,r[1]=(a*w-i*U-o*b)*F,r[2]=(m*_-x*Q+p*T)*F,r[3]=(d*Q-l*_-R*T)*F,r[4]=(h*A-s*U-c*M)*F,r[5]=(n*U-a*A+o*M)*F,r[6]=(x*y-v*_-p*E)*F,r[7]=(f*_-d*y+R*E)*F,r[8]=(s*w-u*A+c*g)*F,r[9]=(i*A-n*w-o*g)*F,r[10]=(v*Q-m*y+p*S)*F,r[11]=(l*y-f*Q-R*S)*F,r[12]=(u*M-s*b-h*g)*F,r[13]=(n*b-i*M+a*g)*F,r[14]=(m*E-v*T-x*S)*F,r[15]=(f*T-l*E+d*S)*F,t):null},this.inverseMat3=function(t){var e=this.data,r=t.data,n=this.determinant();if(Math.abs(n)<1e-4)return console.warn("> SQR.Matrix44 - Attempt to inverse a singular matrix44. ",this.data),console.trace(),t;{var i=e[0],a=e[4],o=e[8],s=(e[12],e[1]),u=e[5],h=e[9],c=(e[13],e[2]),f=e[6],l=e[10];e[14]}return n=1/n,r[0]=(u*l-h*f)*n,r[1]=(o*f-a*l)*n,r[2]=(a*h-o*u)*n,r[3]=(h*c-s*l)*n,r[4]=(i*l-o*c)*n,r[5]=(o*s-i*h)*n,r[6]=(s*f-u*c)*n,r[7]=(a*c-i*f)*n,r[8]=(i*u-a*s)*n,t},this.transpose=function(t){var e=this.data,r=t?t.data||t:this.data,n=e[0],i=e[4],a=e[8],o=e[1],s=e[5],u=e[9],h=e[2],c=e[6],f=e[10];r[0]=n,r[1]=i,r[2]=a,r[4]=o,r[5]=s,r[6]=u,r[8]=h,r[9]=c,r[10]=f},this.lookAt=function(t,e){var r=this.data,n=SQR.V3.__tv1,i=SQR.V3.__tv2,a=SQR.V3.__tv3;return e=e||SQR.V3.up,a.set(r[12],r[13],r[14]),a.sub(a,t).norm(),0===a.magsq()&&(a.z=1),n.cross(e,a).norm(),0===n.magsq()&&(a.x+=1e-4,n.cross(e,a).norm()),i.cross(a,n),r[0]=n.x,r[4]=i.x,r[8]=a.x,r[1]=n.y,r[5]=i.y,r[9]=a.y,r[2]=n.z,r[6]=i.z,r[10]=a.z,this},t||this.identity()},SQR.Matrix44.__temp=new Float32Array(16),SQR.PerlinNoise=function(){for(var t=[151,160,137,91,90,15,131,13,201,95,96,53,194,233,7,225,140,36,103,30,69,142,8,99,37,240,21,10,23,190,6,148,247,120,234,75,0,26,197,62,94,252,219,203,117,35,11,32,57,177,33,88,237,149,56,87,174,20,125,136,171,168,68,175,74,165,71,134,139,48,27,166,77,146,158,231,83,111,229,122,60,211,133,230,220,105,92,41,55,46,245,40,244,102,143,54,65,25,63,161,1,216,80,73,209,76,132,187,208,89,18,169,200,196,135,130,116,188,159,86,164,100,109,198,173,186,3,64,52,217,226,250,124,123,5,202,38,147,118,126,255,82,85,212,207,206,59,227,47,16,58,17,182,189,28,42,223,183,170,213,119,248,152,2,44,154,163,70,221,153,101,155,167,43,172,9,129,22,39,253,19,98,108,110,79,113,224,232,178,185,112,104,218,246,97,228,251,34,242,193,238,210,144,12,191,179,162,241,81,51,145,235,249,14,239,107,49,192,214,31,181,199,106,157,184,84,204,176,115,121,50,45,127,4,150,254,138,236,205,93,222,114,67,29,24,72,243,141,128,195,78,66,215,61,156,180],e=0;256>e;e++)t[256+e]=t[e];var r=function(t){return t*t*t*(t*(6*t-15)+10)},n=function(t,e,r){return e+t*(r-e)},i=function(t,e,r,n){var i=15&t,a=8>i?e:r,o=4>i?r:12==i||14==i?e:n;return(0==(1&i)?a:-a)+(0==(2&i)?o:-o)};return{noise:function(e,a,o){var s=~~e,u=~~a,h=~~o,c=255&s,f=255&u,l=255&h;e-=s,a-=u,o-=h;var d=e-1,R=a-1,v=o-1,m=r(e),x=r(a),p=r(o),S=t[c]+f,E=t[S]+l,y=t[S+1]+l,T=t[c+1]+f,Q=t[T]+l,_=t[T+1]+l;return n(p,n(x,n(m,i(t[E],e,a,o),i(t[Q],d,a,o)),n(m,i(t[y],e,R,o),i(t[_],d,R,o))),n(x,n(m,i(t[E+1],e,a,v),i(t[Q+1],d,a,o-1)),n(m,i(t[y+1],e,R,v),i(t[_+1],d,R,v))))}}}(),SQR.ProjectionMatrix=function(){"undefined"==typeof Float32Array&&(Float32Array=Array),this.data=new Float32Array(16),this.copyTo=function(t){for(var e=this.data,r=t.data||t,n=0;16>n;n++)r[n]=e[n];return t},this.identity()},SQR.ProjectionMatrix.prototype.identity=function(){var t=this.data;return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},SQR.ProjectionMatrix.prototype.screenPixels2d=function(){return this.orthographic(0,window.innerWidth,0,window.innerHeight,-1,1e3),this},SQR.ProjectionMatrix.prototype.orthographic=function(t,e,r,n,i,a){var o=this.data;this.near=i,this.far=a;var s=e-t,u=r-n,h=a-i,c=(e+t)/s,f=(r+n)/u,l=(a+i)/h;return o[0]=2/s,o[4]=0,o[8]=0,o[12]=-c,o[1]=0,o[5]=2/u,o[9]=0,o[13]=-f,o[2]=0,o[6]=0,o[10]=-2/h,o[14]=-l,o[3]=0,o[7]=0,o[11]=0,o[15]=1,this},SQR.ProjectionMatrix.prototype.perspective=function(t,e,r,n){this.near=r,this.far=n,this.fov=t;var i=this.data,a=r*Math.tan(t*Math.PI/360),o=n-r;return i[0]=r/(a*e),i[4]=0,i[8]=0,i[12]=0,i[1]=0,i[5]=r/a,i[9]=0,i[13]=0,i[2]=0,i[6]=0,i[10]=-(n+r)/o,i[14]=-(2*n*r)/o,i[3]=0,i[7]=0,i[11]=-1,i[15]=0,this},SQR.ProjectionMatrix.prototype.transformVector=function(t,e){var r=t.x,n=t.y,i=t.z,a=t.w,o=this.data;return e=e||t,e.x=o[0]*r+o[4]*n+o[8]*i+o[12]*a,e.y=o[1]*r+o[5]*n+o[9]*i+o[13]*a,e.z=o[2]*r+o[6]*n+o[10]*i+o[14]*a,e},SQR.ProjectionMatrix.prototype.inverse=function(t){var e=this.data;t=t||this.data;var r,n=e[0],i=e[1],a=e[2],o=e[3],s=e[4],u=e[5],h=e[6],c=e[7],f=e[8],l=e[9],d=e[10],R=e[11],v=e[12],m=e[13],x=e[14],p=e[15],S=n*u-i*s,E=n*h-a*s,y=n*c-o*s,T=i*h-a*u,Q=i*c-o*u,_=a*c-o*h,g=f*m-l*v,M=f*x-d*v,A=f*p-R*v,b=l*x-d*m,w=l*p-R*m,U=d*p-R*x,F=S*U-E*w+y*b+T*A-Q*M+_*g;return F?(r=1/F,t[0]=(u*U-h*w+c*b)*r,t[1]=(-i*U+a*w-o*b)*r,t[2]=(m*_-x*Q+p*T)*r,t[3]=(-l*_+d*Q-R*T)*r,t[4]=(-s*U+h*A-c*M)*r,t[5]=(n*U-a*A+o*M)*r,t[6]=(-v*_+x*y-p*E)*r,t[7]=(f*_-d*y+R*E)*r,t[8]=(s*w-u*A+c*g)*r,t[9]=(-n*w+i*A-o*g)*r,t[10]=(v*Q-m*y+p*S)*r,t[11]=(-f*Q+l*y-R*S)*r,t[12]=(-s*b+u*M-h*g)*r,t[13]=(n*b-i*M+a*g)*r,t[14]=(-v*T+m*E-x*S)*r,t[15]=(f*T-l*E+d*S)*r,t):null},SQR.Quaternion=function(t,e,r,n){this.set(n,t,e,r)},SQR.Quaternion.prototype.set=function(t,e,r,n){return this.w=n||1,this.x=t||0,this.y=e||0,this.z=r||0,this},SQR.Quaternion.prototype.copyTo=function(t){return t.x=this.x,t.y=this.y,t.z=this.z,t.w=this.w,this},SQR.Quaternion.prototype.copyFrom=function(t){return this.w=t.w,this.x=t.x,this.y=t.y,this.z=t.z,this},SQR.Quaternion.prototype.identity=function(){return this.set(),this},SQR.Quaternion.prototype.mul=function(t,e){e=e||this;var r=e.w*t.w-e.x*t.x-e.y*t.y-e.z*t.z,n=e.w*t.x+e.x*t.w+e.y*t.z-e.z*t.y,i=e.w*t.y-e.x*t.z+e.y*t.w+e.z*t.x,a=e.w*t.z+e.x*t.y-e.y*t.x+e.z*t.w;return e.set(n,i,a,r),e.normalize(),e},SQR.Quaternion.prototype.dot=function(){return this.x*v.x+this.y*v.y+this.z*v.z+this.w*v.w},SQR.Quaternion.prototype.lookAt=function(t,e){var r=SQR.Quaternion.__tv1,n=SQR.Quaternion.__tv2,i=SQR.Quaternion.__tv3;t.copyTo(r),e.copyTo(i),r.norm(),-1==r.z&&(r.x=1e-4,r.norm()),n.cross(i,r),i.cross(r,n),this.w=.5*Math.sqrt(1+n.x+i.y+r.z);var a=4*this.w;return this.x=(r.y-i.z)/a,this.y=(n.z-r.x)/a,this.z=(i.x-n.y)/a,this.normalize(),this},SQR.Quaternion.prototype.fromAngleAxis=function(t,e,r,n){var i=Math.sin(t/2);return this.x=e*i,this.y=r*i,this.z=n*i,this.w=Math.cos(t/2),this},SQR.Quaternion.prototype.mag=function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},SQR.Quaternion.prototype.normalize=function(){var t=this.mag();return this.x/=t,this.y/=t,this.z/=t,this.w/=t,this},SQR.Quaternion.prototype.neg=function(){return this.x*=-1,this.y*=-1,this.z*=-1,this.w*=-1,this},SQR.Quaternion.prototype.toMatrix=function(){throw"SQR.Quaternion.toMatrix() is not implemented. Check SQR.Matrix44.TQS()"},SQR.Quaternion.slerp=function(t,e,r,n){if(n=n||new SQR.Quaternion,0===r)return n.copyFrom(t);if(1===r)return n.copyFrom(e);var i=SQR.Quaternion.dot(t,e);0>i&&(t.neg(),i=SQR.Quaternion.dot(t,e));var a=Math.acos(i),o=Math.sqrt(1-i*i),s=Math.sin((1-r)*a)/o,u=Math.sin(r*a)/o;return Math.abs(i)>=1?(s=1,u=0):Math.abs(o)<.001&&(s=.5,u=.5),n.w=t.w*s+e.w*u,n.x=t.x*s+e.x*u,n.y=t.y*s+e.y*u,n.z=t.z*s+e.z*u,n},SQR.Quaternion.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z+t.w*e.w},SQR.Quaternion.prototype.slerp=function(t,e,r){return SQR.Quaternion.slerp(t,e,r,this),this},SQR.Quaternion.__tv1=new SQR.Quaternion,SQR.Quaternion.__tv2=new SQR.Quaternion,SQR.Quaternion.__tv3=new SQR.Quaternion,SQR.Spline=function(){var t,e,r=[],n=[],i=[],a={},o=function(r,n,i,a,o,s){var u=t.sub(r,n).neg(),h=e.sub(r,i),c=s>1?s:s*Math.min(u.mag(),h.mag());a.set().add(u,h).norm().mul(c),o.copyFrom(a).neg(),a.add(a,r),o.add(o,r)};return a.addSegment=function(r){var o;if(void 0!==r.x)o=r;else{var s=arguments,u=s.length;2==u?o=new SQR.V2(s[0],s[1]):3==u&&(o=new SQR.V3(s[0],s[1],s[2]))}return n.push(o),i.push(o.clone(),o.clone()),t||(t=n[0].clone(),e=n[0].clone()),a},a.create=function(t,e){if(n.length<2)return n;t=null!==t?t:.5,r.length=0;for(var s=n,u=i,h=n.length,c=0;h>c;c++){var f=s[c],l=u[2*c].set(),d=u[2*c+1].set(),R=0==c?s[h-1]:s[c-1],v=c==h-1?s[0]:s[c+1];o(f,R,v,l,d,t),u.push(l,d)}for(var c=0;h-1>c;c++){var R=s[c],v=c==h-1?s[0]:s[c+1],l=0!=c||e?u[2*c+1]:R,d=c!=h-2||e?u[2*c+2]:v,m=new SQR.Bezier(R,l,d,v);r.push(m)}if(e){var m=new SQR.Bezier(s[h-1],u[2*(h-1)+1],u[0],s[0]);r.push(m)}return a},a.valueAt=function(t,e){1==t&&(t=.999999),t%=1;var n=t*r.length;return r[0|n].valueAt(n%1,e)},a.velocityAt=function(t,e){1==t&&(t=.999999),t%=1;var n=t*r.length;return r[0|n].velocityAt(n%1,e)},a.matrixAt=function(t,e){0==t&&(t=SQR.EPSILON),1==t&&(t=1-SQR.EPSILON),t%=1;var n=t*r.length;return r[0|n].matrixAt(n%1,e)},Object.defineProperty(a,"segments",{get:function(){return n}}),Object.defineProperty(a,"points",{get:function(){return r}}),a},SQR.Triangle=function(t,e,r){this.v0=t,this.v1=e,this.v2=r,this.calculateCentroid=function(){this.centroid=new SQR.V2,this.centroid.x=(this.v0.x+this.v1.x+this.v2.x)/3,this.centroid.y=(this.v0.y+this.v1.y+this.v2.y)/3},this.calculateCircumCircle=function(){var t,e,r=this.v1.x-this.v0.x,n=this.v1.y-this.v0.y,i=this.v2.x-this.v0.x,a=this.v2.y-this.v0.y,o=r*(this.v0.x+this.v1.x)+n*(this.v0.y+this.v1.y),s=i*(this.v0.x+this.v2.x)+a*(this.v0.y+this.v2.y),u=2*(r*(this.v2.y-this.v1.y)-n*(this.v2.x-this.v1.x));if(Math.abs(u)<SQR.EPSILON){var h=Math.min(this.v0.x,this.v1.x,this.v2.x),c=Math.min(this.v0.y,this.v1.y,this.v2.y),f=Math.max(this.v0.x,this.v1.x,this.v2.x),l=Math.max(this.v0.y,this.v1.y,this.v2.y);this.circumCenter=new SQR.V2((h+f)/2,(c+l)/2),t=this.circumCenter.x-h,e=this.circumCenter.y-c}else{var d=(a*o-n*s)/u,R=(r*s-i*o)/u;this.circumCenter=new SQR.V2(d,R),t=this.circumCenter.x-this.v0.x,e=this.circumCenter.y-this.v0.y}this.circumRadiusSq=t*t+e*e,this.circumRadius=Math.sqrt(this.circumRadiusSq)},this.vertexInCircumcircle=function(t){this.circumCenter||this.calculateCircumCircle();var e=this.circumCenter.x-t.x,r=this.circumCenter.y-t.y,n=e*e+r*r;return n<=this.circumRadiusSq}},SQR.V2=function(t,e){this.set(t,e),this.size=2},SQR.V2.prototype.set=function(t,e){return this.x=t||0,this.y=e||0,this},SQR.V2.prototype.copyTo=function(t){return t.x=this.x,t.y=this.y,t},SQR.V2.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this},SQR.V2.prototype.clone=function(){return new SQR.V2(this.x,this.y)},SQR.V2.prototype.magsq=function(){return this.x*this.x+this.y*this.y},SQR.V2.prototype.mag=function(){return Math.sqrt(this.magsq())},SQR.V2.prototype.isZero=function(){return 0==this.x&&0==this.y},SQR.V2.prototype.mul=function(t){return this.x*=t,this.y*=t,this},SQR.V2.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this},SQR.V2.prototype.norm=function(){var t=1/this.mag();return this.set(this.x*t,this.y*t),this},SQR.V2.prototype.add=function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this},SQR.V2.prototype.sub=function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this},SQR.V2.prototype.lerp=function(t,e,r){return this.x=t.x+(e.x-t.x)*r,this.y=t.y+(e.y-t.y)*r,this},SQR.V2.dot=function(t,e){return t.x*e.x+t.y*e.y},SQR.V2.prototype.perp=function(){return this.set(this.y,-this.x),this},SQR.V2.prototype.toUniform=function(){return this.toArray()},SQR.V2.prototype.toArray=function(){return this.array||(this.array=new Float32Array(2)),this.array[0]=this.x,this.array[1]=this.y,this.array},SQR.V3=function(t,e,r){this.set(t,e,r),this.size=3},SQR.V3.prototype.set=function(t,e,r,n){return this.x=t||0,this.y=e||0,this.z=r||0,this.w=n||1,this},SQR.V3.prototype.copyTo=function(t){return t.x=this.x,t.y=this.y,void 0!=t.z&&(t.z=this.z),t},SQR.V3.prototype.copyFrom=function(t){return this.x=t.x,this.y=t.y,this.z=t.z||0,this},SQR.V3.prototype.clone=function(){return new SQR.V3(this.x,this.y,this.z)},SQR.V3.prototype.magsq=function(){return this.x*this.x+this.y*this.y+this.z*this.z},SQR.V3.prototype.mag=function(){return Math.sqrt(this.magsq())},SQR.V3.prototype.isZero=function(){},SQR.V3.prototype.mul=function(t){return this.x*=t,this.y*=t,this.z*=t,this},SQR.V3.prototype.neg=function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},SQR.V3.prototype.norm=function(){var t=1/this.mag();return this.set(this.x*t,this.y*t,this.z*t),this},SQR.V3.prototype.add=function(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this},SQR.V3.prototype.sub=function(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this},SQR.V3.prototype.lerp=function(t,e,r){return this.x=t.x+(e.x-t.x)*r,this.y=t.y+(e.y-t.y)*r,this.z=t.z+(e.z-t.z)*r,this},SQR.V3.prototype.random=function(){return this.x=2*Math.random()-1,this.y=2*Math.random()-1,this.z=2*Math.random()-1,this},SQR.V3.dot=function(t,e){return t.x*e.x+t.y*e.y+t.z*e.z},SQR.V3.prototype.cross=function(t,e){var r=t.y*e.z-t.z*e.y,n=t.z*e.x-t.x*e.z,i=t.x*e.y-t.y*e.x;return this.set(r,n,i,this.w),this},SQR.V3.prototype.toUniform=function(){return this.toArray()},SQR.V3.prototype.toArray=function(){return this.array||(this.array=new Float32Array(3)),this.array[0]=this.x,this.array[1]=this.y,this.array[2]=this.z,this.array},SQR.V3.prototype.toScreenSpace=function(t,e){t=t||window.innerWidth,e=e||window.innerHeight,this.x=this.x/this.z*t/2+t/2,this.y=this.y/this.z*e/2+e/2,this.y=e-this.y},SQR.V3.prototype.addNormal=function(t){this.normal||(this.normal=new SQR.V3),this.normal.add(this.normal,t)},SQR.V3.prototype.resetNormal=function(){this.normal&&this.normal.set()},SQR.V3.up=new SQR.V3(0,1,0),SQR.V3.forward=new SQR.V3(0,0,1),SQR.V3.__tv1=new SQR.V3,SQR.V3.__tv2=new SQR.V3,SQR.V3.__tv3=new SQR.V3,SQR.CanvasRenderer=function(t){var e={},r=null,n="> SQR.Context - Invalid canvas reference.";if(t||(t=document.createElement("canvas")),t instanceof HTMLElement||(t=document.querySelector(t)),!t.getContext)throw n;var i=t.getContext("2d");return i.setLineDash||(i.setLineDash=function(){}),e.canvas=t,e.setSize=function(r,n){return t.width=r,t.height=n,e},e.setClearColor=function(t){return r=t,e},e.render=function(e){r?(r.indexOf("rgba")>-1&&i.clearRect(0,0,t.width,t.height),i.fillStyle=r,i.fillRect(0,0,t.width,t.height)):i.clearRect(0,0,t.width,t.height),e&&e.draw(i)},e},SQR.Transform2d=function(t){var e={};return e.name=t||"sqr.transform."+SQR.Transform2dCount++,e.position=new SQR.V3(0,0,0),e.rotation=0,e.scale=new SQR.V2(1,1),e.alpha=1,e.children=[],e.numChildren=0,e.add=function(){for(var t=0;t<arguments.length;t++){var r=arguments[t];r.parent=e,-1==e.children.indexOf(r)&&e.children.push(r)}return e.numChildren=e.children.length,e},e.remove=function(){for(var t=0;t<arguments.length;t++){var r=arguments[t],n=e.children.indexOf(r);if(-1==n)return!1;r.parent=null,e.children.splice(n,1)}return e.numChildren=e.children.length,e},e.removeAll=function(){e.children.length=0,e.numChildren=0},e.contains=function(t){return e.children.indexOf(t)>-1},e.recurse=function(t,r){r||t(e);for(var n=0;n<e.numChildren;n++)e.children[n].recurse(t)},e.draw=function(t){var r=t;r.save(),r.translate(e.position.x,e.position.y),r.rotate(e.rotation),r.scale(e.scale.x,e.scale.y);for(var n=0;n<e.numChildren;n++)e.children[n].draw(r);e.alpha<1&&(r.globalAlpha=e.alpha),e.shape&&e.shape(r),r.restore()},e},SQR.Transform2dCount=0;